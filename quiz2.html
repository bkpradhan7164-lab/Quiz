<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RRB Section Control — Full-Length Test (50 Qs)</title>
<style>
  :root{--brand:#2563eb;--danger:#b91c1c;--muted:#6b7280}
  body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial; background:#f8fafc; margin:0}
  .wrap{max-width:1100px;margin:18px auto;padding:18px}
  .card{background:#fff;border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{font-size:20px;margin:0}
  #timer{font-weight:700;color:var(--danger);font-size:16px}
  .intro ul{margin-top:6px}
  input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #e5e7eb}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
  button{background:var(--brand);color:#fff;padding:9px 12px;border-radius:8px;border:none;cursor:pointer}
  button.secondary{background:#64748b}
  .qbox{margin-top:14px}
  .qtext{font-weight:600;margin-bottom:10px}
  .opts{display:block;margin-bottom:6px}
  label.opt{display:block;padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px;cursor:pointer;background:#fff}
  label.opt input{margin-right:8px}
  .nav-numbers{display:flex;flex-wrap:wrap;gap:6px;padding:10px 0}
  .nav-numbers button{width:40px;height:36px;border-radius:6px;padding:0}
  .nav-numbers button.current{background:#60a5fa}
  .result{margin-top:12px}
  .summary{margin-top:12px;max-height:320px;overflow:auto;padding:8px;border-radius:8px;border:1px solid #e6e6e6}
  .footer{margin-top:14px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="startCard">
    <header>
      <div>
        <h1>RRB Section Control — Full-Length Test</h1>
        <div style="color:var(--muted);margin-top:6px">50 Questions | Time: 45 minutes | Each question = 1 mark</div>
      </div>
      <div style="text-align:right">
        <div id="timer" style="display:none">45:00</div>
        <div style="font-size:12px;color:var(--muted)">Time Remaining</div>
      </div>
    </header>

    <div class="intro" style="margin-top:14px">
      <p><strong>Instructions:</strong></p>
      <ul>
        <li>Enter your name and press <strong>Start Exam</strong>. The exam will go full-screen and the 45-minute timer will begin.</li>
        <li>Do not exit full-screen or switch tabs — doing so will auto-submit your exam.</li>
        <li>You may navigate using the numbered buttons, and submit when done. The timer will auto-submit when time ends.</li>
      </ul>

      <p><label>Student name (required)</label>
      <input type="text" id="studentName" placeholder="Enter your full name" /></p>

      <div class="controls">
        <button id="startBtn">Start Exam</button>
        <button class="secondary" id="demoBtn">Demo (No Fullscreen)</button>
      </div>
    </div>
  </div>

  <div class="card" id="quizCard" style="display:none;margin-top:14px">
    <header style="align-items:flex-start">
      <div>
        <h2 id="qHeading">Question 1</h2>
        <div style="color:var(--muted)" id="qCategory"></div>
      </div>
      <div style="text-align:right">
        <div id="timerTop" style="font-weight:700;color:var(--danger);font-size:18px">45:00</div>
        <div style="font-size:12px;color:var(--muted)">Time Remaining</div>
      </div>
    </header>

    <div class="qbox" id="qbox">
      <!-- question will be injected here -->
    </div>

    <div class="nav-numbers" id="navNumbers" aria-label="Question navigation"></div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div>
        <button id="prevBtn" class="secondary">◀ Prev</button>
        <button id="nextBtn">Next ▶</button>
      </div>
      <div>
        <button id="submitBtn" style="background:#16a34a">Submit Exam</button>
      </div>
    </div>

    <div class="footer">You must remain in full-screen mode. Switching tabs or exiting full-screen will auto-submit.</div>
  </div>

  <div class="card" id="resultCard" style="display:none;margin-top:14px">
    <h2>Exam Submitted</h2>
    <div id="resultSummary" class="result"></div>
    <div class="summary" id="detailSummary"></div>
  </div>
</div>
<style>
<script>
/*
 Quiz data built from your LaTeX question set.
 For each item: { cat, q, opts:[A,B,C,D], ans, marks }
 NOTE: ans values are provided (used for scoring).
*/
const quiz = [
  {cat:"Number System", q:"If x = 0.4 <span style="text-decoration: overline;">36</span> (i.e. 0.436363...), find the value of 100x - x.", opts:["39","36","40","43"], ans:"43", marks:1},
  {cat:"LCM–HCF", q:"The LCM of two numbers is 180 and their HCF is 15. If one number is 45, find the other.", opts:["60","75","40","90"], ans:"60", marks:1},
  {cat:"Percentage", q:"A number increases by 25% and then decreases by 20%. The net change is:", opts:["0%","+5%","–5%","–10%"], ans:"0%", marks:1},
  {cat:"Ratio", q:"If A:B:C = 2:3:5 and total = 5000, find C.", opts:["2000","2500","3000","3500"], ans:"2500", marks:1},
  {cat:"Profit & Loss", q:"A trader marks goods 40% above cost and allows 10% discount. Find gain %.", opts:["26%","27%","28%","30%"], ans:"26%", marks:1},
  {cat:"Compound Interest", q:"Rs. 8000 becomes Rs. 9261 in 2 years. Find rate p.a. (compound annually).", opts:["7%","8%","9%","10%"], ans:"7.5%", marks:1},
  {cat:"Algebra", q:"If a + b = 10 and ab = 21, find a^2 + b^2.", opts:["37","38","40","58"], ans:"58", marks:1},
  {cat:"Equation", q:"Solve x^2 - 5x + 6 = 0.", opts:["1, 6","2, 3","1, 5","3, 5"], ans:"2, 3", marks:1},
  {cat:"AP", q:"Find the sum of first 15 terms of AP 5, 8, 11, ....", opts:["315","330","345","360"], ans:"390", marks:1},
  {cat:"Geometry", q:"The diagonal of a rectangle is 10 cm and one side is 6 cm. Find area.", opts:["48 cm^2","60 cm^2","64 cm^2","80 cm^2"], ans:"48 cm^2", marks:1},
  {cat:"Volume", q:"Find volume of a cone of height 12 cm and radius 7 cm. (pi = 22/7)", opts:["616 cm^3","800 cm^3","924 cm^3","1100 cm^3"], ans:"616 cm^3", marks:1},
  {cat:"Probability", q:"A card is drawn from a deck. Find probability it is a red king.", opts:["1/26","1/13","1/52","2/52"], ans:"1/26", marks:1},
  {cat:"Statistics", q:"Mean of 6 numbers is 8. If one number is removed, mean becomes 7.5. Find removed number.", opts:["9","10","11","12"], ans:"10.5", marks:1},
  {cat:"Data Interpretation", q:"In a survey, out of 500 people, 300 like coffee, 200 like tea, and 100 both. How many like neither?", opts:["50","80","100","150"], ans:"100", marks:1},
  {cat:"Syllogism", q:"Statements: All pens are blue; Some blue are pencils. Conclusions: (1) Some pencils may be pens. (2) Some pens are not pencils.", opts:["Only 1 follows","Only 2 follows","Both","None"], ans:"Only 1 follows", marks:1},
  {cat:"Coding-Decoding", q:"If DOG = 4157, CAT = 3120, find BAT.", opts:["2120","2140","2130","2110"], ans:"2120", marks:1},
  {cat:"Analogy", q:"Iron : Metal :: Mercury : ?", opts:["Gas","Solid","Liquid","Non-metal"], ans:"Liquid", marks:1},
  {cat:"Clock", q:"What is the angle between hands at 2:24?", opts:["60°","72°","78°","84°"], ans:"72°", marks:1},
  {cat:"Direction", q:"A walks 4 km North, 3 km East, 2 km South. Distance from start = ?", opts:["3 km","4 km","5 km","6 km"], ans:"√13", marks:1},
  {cat:"Blood Relation", q:"A’s father is brother of B’s mother. How is A related to B?", opts:["Cousin","Uncle","Brother","Nephew"], ans:"Cousin", marks:1},
  {cat:"Series", q:"3, 6, 11, 18, 27, ?", opts:["36","38","40","42"], ans:"38", marks:1},
  {cat:"Binary Logic", q:"If A=1, B=0, evaluate (A OR B) AND (A XOR B).", opts:["0","1","Undefined","None"], ans:"1", marks:1},
  {cat:"Puzzle", q:"If 1 apple + 2 bananas = 8 and 1 banana + 3 mangoes = 11, find value of 1 apple + 1 banana + 1 mango.", opts:["6","7","8","9"], ans:"9", marks:1},
  {cat:"Analogy", q:"Hand : Palm :: Foot : ?", opts:["Toe","Heel","Sole","Nail"], ans:"Sole", marks:1},
  {cat:"Data Sufficiency", q:"What is the area of a square? (1) Diagonal = 10 cm. (2) Perimeter = 28 cm.", opts:["1 alone","2 alone","Either","Both"], ans:"Either", marks:1},
  {cat:"Ranking", q:"A is 10th from top, B is 15th from bottom, total 30 students. Rank of A from bottom?", opts:["20","21","22","23"], ans:"21", marks:1},
  {cat:"Direction", q:"Facing North, turn right, walk 3 km, turn right again, walk 4 km, turn left, walk 2 km. Final direction?", opts:["North","East","South","West"], ans:"East", marks:1},
  {cat:"Series", q:"5, 10, 20, 40, 80, ?", opts:["100","120","160","200"], ans:"160", marks:1},
  {cat:"Statement", q:"\"All artists are creative. Some creative people are rich.\" Conclusion: ?", opts:["All artists are rich","Some artists are rich","Some rich are creative","None"], ans:"Some rich are creative", marks:1},
  {cat:"Puzzle", q:"Five friends A–E have birthdays in consecutive months. If A’s birthday is before C’s, E’s after D’s, and C not last, who is last?", opts:["A","B","D","E"], ans:"B", marks:1},
  {cat:"Work", q:"A can do work in 10 days, B in 15. Together they work 5 days, remaining work = ?", opts:["1/2","1/3","1/4","1/6"], ans:"1/6", marks:1},
  {cat:"Trigonometry", q:"If tan(theta) = 3/4, find sin(theta).", opts:["3/5","4/5","5/3","1/2"], ans:"3/5", marks:1},
  {cat:"Mensuration", q:"Perimeter of circle = 44 cm. Find area.", opts:["121 cm^2","132 cm^2","144 cm^2","154 cm^2"], ans:"154 cm^2", marks:1},
  {cat:"Logical Deduction", q:"If all engineers are graduates and some graduates are doctors, which is true?", opts:["Some doctors are engineers","All graduates are engineers","Some engineers are graduates","None"], ans:"Some engineers are graduates", marks:1},
  {cat:"Series", q:"7, 14, 21, 28, 35, ?", opts:["42","45","48","49"], ans:"42", marks:1},
  {cat:"Coding", q:"In a certain code, FRUIT = GSVJU. What is the code for APPLE?", opts:["BQQMF","BQQNF","CQQLF","ZOOLD"], ans:"BQQMF", marks:1},
  {cat:"Data Interpretation", q:"A graph shows sales of A = 40, B = 60, C = 80, D = 120. What is % increase from A to D?", opts:["100%","150%","200%","300%"], ans:"200%", marks:1},
  {cat:"Reasoning", q:"If 3 → 27, 4 → 64, 5 → ?, then ? =", opts:["100","120","125","150"], ans:"125", marks:1},
  {cat:"Venn Diagram", q:"In a class, 50 like Physics, 40 like Chemistry, 20 both. Find total students who like at least one.", opts:["70","80","90","100"], ans:"70", marks:1},
  {cat:"Probability", q:"A coin is tossed 3 times. Find probability of at least one head.", opts:["1/2","3/4","7/8","1"], ans:"7/8", marks:1},
  {cat:"Ranking", q:"In a test of 100 students, A ranks 15th from top, B ranks 20th from bottom. How many between them?", opts:["64","65","66","67"], ans:"65", marks:1},
  {cat:"Statement", q:"\"If it rains, I take an umbrella.\" It did not rain. What can you infer?", opts:["I took umbrella","I didn’t take umbrella","Can’t say","Always true"], ans:"Can’t say", marks:1},
  {cat:"Clock", q:"How many times do hands coincide in 12 hours?", opts:["11","12","22","24"], ans:"11", marks:1},
  {cat:"Direction", q:"A is 20 m North of B; C is 15 m East of A. Find shortest distance between B and C.", opts:["15 m","20 m","25 m","30 m"], ans:"25 m", marks:1},
  {cat:"Blood Relation", q:"A’s father’s only son’s wife’s mother is related to A as:", opts:["Mother","Mother-in-law","Aunt","Sister"], ans:"Mother-in-law", marks:1},
  {cat:"Data Analysis", q:"If company’s revenue grows from 120 crore to 180 crore, what is % growth?", opts:["40%","45%","50%","60%"], ans:"50%", marks:1},
  {cat:"Reasoning", q:"If all squares are rectangles and all rectangles are polygons, which conclusion follows?", opts:["All polygons are squares","All squares are polygons","Some polygons are not rectangles","None"], ans:"All squares are polygons", marks:1},
  {cat:"Series", q:"11, 13, 17, 19, 23, ?", opts:["25","27","29","31"], ans:"29", marks:1},
  {cat:"Math", q:"A can do a work in 12 days; B is 50% more efficient. Together time = ?", opts:["6 days","7 days","8 days","9 days"], ans:"24/5 days (4.8 days)", marks:1},
  {cat:"Logical Puzzle", q:"If 9 + 3 = 27, 8 + 4 = 32, 6 + 5 = ?, find ?.", opts:["30","32","35","36"], ans:"30", marks:1}
];

// state
let currentIndex = 0;
const total = quiz.length;
const responses = new Array(total).fill(null);
let studentName = '';
let timerSec = 45*60;
let timerInterval = null;
let examStarted = false;

// DOM refs
const startCard = document.getElementById('startCard');
const quizCard = document.getElementById('quizCard');
const resultCard = document.getElementById('resultCard');
const qHeading = document.getElementById('qHeading');
const qCategory = document.getElementById('qCategory');
const qbox = document.getElementById('qbox');
const navNumbers = document.getElementById('navNumbers');
const timerTop = document.getElementById('timerTop');
const timerMain = document.getElementById('timer');

function buildNav(){
  navNumbers.innerHTML = '';
  for(let i=0;i<total;i++){
    const btn = document.createElement('button');
    btn.textContent = (i+1);
    btn.dataset.idx = i;
    btn.onclick = ()=>{ saveCurrent(); currentIndex = i; renderQuestion(); };
    if(i===0) btn.classList.add('current');
    navNumbers.appendChild(btn);
  }
}

function renderQuestion(){
  const item = quiz[currentIndex];
  qHeading.textContent = `Question ${currentIndex+1}`;
  qCategory.textContent = item.cat;
  // build HTML
  let html = `<div class="qtext">${item.q}</div>`;
  html += `<div>`;
  for(let i=0;i<item.opts.length;i++){
    const opt = item.opts[i];
    const checked = responses[currentIndex] === opt ? 'checked' : '';
    html += `<label class="opt"><input type="radio" name="opt" value="${escapeHtml(opt)}" ${checked}/> <strong>${String.fromCharCode(65+i)}.</strong> ${opt}</label>`;
  }
  html += `</div>`;
  qbox.innerHTML = html;
  // highlight nav
  Array.from(navNumbers.children).forEach((b,idx)=> b.classList.toggle('current', idx===currentIndex));
}

function saveCurrent(){
  const sel = qbox.querySelector('input[name="opt"]:checked');
  if(sel) responses[currentIndex] = sel.value;
}

document.getElementById('startBtn').addEventListener('click', startExam);
document.getElementById('demoBtn').addEventListener('click', startDemo);
document.getElementById('prevBtn').addEventListener('click', ()=>{
  saveCurrent(); if(currentIndex>0) currentIndex--; renderQuestion();
});
document.getElementById('nextBtn').addEventListener('click', ()=>{
  saveCurrent(); if(currentIndex<total-1) currentIndex++; renderQuestion();
});
document.getElementById('submitBtn').addEventListener('click', ()=>{
  if(!confirm('Submit exam now?')) return;
  finishExam();
});

// full-screen helpers
function openFullscreen(){
  const el = document.documentElement;
  if(el.requestFullscreen) el.requestFullscreen();
  else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  else if(el.msRequestFullscreen) el.msRequestFullscreen();
}
function closeFullscreen(){
  if(document.exitFullscreen) document.exitFullscreen();
  else if(document.webkitExitFullscreen) document.webkitExitFullscreen();
  else if(document.msExitFullscreen) document.msExitFullscreen();
}

// visibility / tab change -> auto submit
document.addEventListener('visibilitychange', ()=>{
  if(!examStarted) return;
  if(document.hidden){
    alert('You switched tab or minimized the browser. The exam will be submitted.');
    finishExam();
  }
});

// detect fullscreen exit -> auto submit
document.addEventListener('fullscreenchange', ()=>{
  if(!examStarted) return;
  if(!document.fullscreenElement){
    alert('You exited full-screen. The exam will be submitted.');
    finishExam();
  }
});

function startExam(){
  const nameInput = document.getElementById('studentName').value.trim();
  if(!nameInput){ alert('Please enter your name to start.'); return; }
  studentName = nameInput;
  // go fullscreen
  openFullscreen();
  startCore();
}
function startDemo(){
  // starts without fullscreen for quick testing
  studentName = document.getElementById('studentName').value.trim() || 'Demo Student';
  startCore(true);
}

function startCore(demo=false){
  examStarted = true;
  startCard.style.display = 'none';
  quizCard.style.display = 'block';
  timerMain.style.display = demo ? 'none' : 'block';
  timerTop.style.display = 'block';
  buildNav();
  renderQuestion();
  // start timer
  timerTop.textContent = formatTime(timerSec);
  timerMain.textContent = formatTime(timerSec);
  timerInterval = setInterval(()=>{
    timerSec--;
    timerTop.textContent = formatTime(timerSec);
    timerMain.textContent = formatTime(timerSec);
    if(timerSec<=0){
      clearInterval(timerInterval);
      alert('Time is up — exam will be submitted.');
      finishExam();
    }
  },1000);
}

function formatTime(s){
  const m = Math.floor(s/60); const sec = s%60;
  return String(m).padStart(2,'0')+':'+String(sec).padStart(2,'0');
}

function finishExam(){
  if(!examStarted) return;
  examStarted = false;
  clearInterval(timerInterval);
  saveCurrent();
  // scoring
  let score=0, max=0; const details=[];
  quiz.forEach((it,i)=>{
    max += it.marks;
    const given = responses[i];
    const correct = it.ans;
    const got = (given===correct) ? it.marks : 0;
    score += got;
    details.push({q:it.q, given: given || '(no answer)', correct, marks: got});
  });
  // show result
  quizCard.style.display = 'none';
  resultCard.style.display = 'block';
  document.getElementById('resultSummary').innerHTML = `<p><strong>Name:</strong> ${escapeHtml(studentName)}<br>
    <strong>Score:</strong> ${score} / ${max} &nbsp; (<strong>${((score/max)*100).toFixed(2)}%</strong>)</p>`;
  const detailDiv = document.getElementById('detailSummary');
  detailDiv.innerHTML = '';
  details.forEach((d,idx)=>{
    const el = document.createElement('div');
    el.style.padding = '6px 0';
    el.style.borderBottom = '1px dashed #eee';
    el.innerHTML = `<strong>Q${idx+1}:</strong> ${escapeHtml(d.q)}<br>
      <strong>Your answer:</strong> ${escapeHtml(d.given)} &nbsp; <strong>Correct:</strong> ${escapeHtml(d.correct)}`;
    detailDiv.appendChild(el);
  });
  // exit fullscreen if needed
  try{ closeFullscreen(); }catch(e){}
  // disable further interactions
  document.getElementById('submitBtn').disabled=true;
  document.getElementById('prevBtn').disabled=true;
  document.getElementById('nextBtn').disabled=true;
  Array.from(navNumbers.children).forEach(b=>b.disabled=true);
}

// small helper to escape HTML
function escapeHtml(str){
  if(str===null || str===undefined) return '';
  return String(str).replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
}
</script>
<script>
document.getElementById("quizForm").addEventListener("submit", function(e) {
  e.preventDefault();
  
  const name = document.getElementById("studentName").value;
  const email = document.getElementById("studentEmail") ? document.getElementById("studentEmail").value : "";
  const score = window.quizScore || 0;  // from your quiz logic
  const answers = JSON.stringify(window.userAnswers || {});

  fetch("https://script.google.com/macros/s/AKfycbym7870t9FYTGPZqgXjxzS2WdL4ye4uqfudkpfVQHAAJUUKn6DPt6RQRCIvlyHfJmSk/exec", {
    method: "POST",
    body: new URLSearchParams({ name, email, score, answers })
  })
  .then(() => {
    alert("Quiz submitted successfully!");
  })
  .catch(err => alert("Error submitting quiz: " + err));
});
</script>
</body>
</html>
