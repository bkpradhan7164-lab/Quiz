<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RRB Section Control — Full-Length Test (50 Qs)</title>
<style>
  :root{--brand:#2563eb;--danger:#b91c1c;--muted:#6b7280}
  body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial; background:#f8fafc; margin:0}
  .wrap{max-width:1100px;margin:18px auto;padding:18px}
  .card{background:#fff;border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{font-size:20px;margin:0}
  #timer{font-weight:700;color:var(--danger);font-size:16px}
  .intro ul{margin-top:6px}
  input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #e5e7eb}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
  button{background:var(--brand);color:#fff;padding:9px 12px;border-radius:8px;border:none;cursor:pointer}
  button.secondary{background:#64748b}
  .qbox{margin-top:14px}
  .qtext{font-weight:600;margin-bottom:10px}
  .opts{display:block;margin-bottom:6px}
  label.opt{display:block;padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px;cursor:pointer;background:#fff}
  label.opt input{margin-right:8px}
  .nav-numbers{display:flex;flex-wrap:wrap;gap:6px;padding:10px 0}
  .nav-numbers button{width:40px;height:36px;border-radius:6px;padding:0}
  .nav-numbers button.current{background:#60a5fa}
  .result{margin-top:12px}
  .summary{margin-top:12px;max-height:320px;overflow:auto;padding:8px;border-radius:8px;border:1px solid #e6e6e6}
  .footer{margin-top:14px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<form id="quizForm">
<div class="wrap">
  <!-- START CARD -->
  <div class="card" id="startCard">
    <header>
      <div>
        <h1>RRB Section Control — Full-Length Test 6</h1>
        <div style="color:var(--muted);margin-top:6px">50 Questions | Time:30 minutes | Each question = 1 mark</div>
      </div>
      <div style="text-align:right">
        <div id="timer" style="display:none">30:00</div>
        <div style="font-size:12px;color:var(--muted)">Time Remaining</div>
      </div>
    </header>

    <div class="intro" style="margin-top:14px">
      <p><strong>Instructions:</strong></p>
      <ul>
        <li>Enter your name and press <strong>Start Exam</strong>. The exam will go full-screen and the 30-minute timer will begin.</li>
        <li>Do not exit full-screen or switch tabs — doing so will auto-submit your exam.</li>
        <li>You may navigate using the numbered buttons, and submit when done. The timer will auto-submit when time ends.</li>
      </ul>

      <p><label>Student name (required)</label>
      <input type="text" id="studentName" placeholder="Enter your full name" /></p>

      <div class="controls">
        <button id="startBtn">Start Exam</button>
        <button class="secondary" id="demoBtn">Demo (No Fullscreen)</button>
      </div>
    </div>
  </div>

  <!-- QUIZ CARD -->
  <div class="card" id="quizCard" style="display:none;margin-top:14px">
    <header style="align-items:flex-start">
      <div>
        <h2 id="qHeading">Question 1</h2>
        <div style="color:var(--muted)" id="qCategory"></div>
      </div>
      <div style="text-align:right">
        <div id="timerTop" style="font-weight:700;color:var(--danger);font-size:18px">30:00</div>
        <div style="font-size:12px;color:var(--muted)">Time Remaining</div>
      </div>
    </header>

    <div class="qbox" id="qbox"></div>
    <div class="nav-numbers" id="navNumbers"></div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div>
        <button id="prevBtn" class="secondary" type="button">◀ Prev</button>
        <button id="nextBtn" type="button">Next ▶</button>
      </div>
      <div>
        <button id="submitBtn" style="background:#16a34a" type="button">Submit Exam</button>
      </div>
    </div>

    <div class="footer">You must remain in full-screen mode. Switching tabs or exiting full-screen will auto-submit.</div>
  </div>

  <!-- RESULT CARD -->
  <div class="card" id="resultCard" style="display:none;margin-top:14px">
    <h2>Exam Submitted</h2>
    <div id="resultSummary" class="result"></div>
    <div class="summary" id="detailSummary"></div>
  </div>
</div>
</form>

<script>
// ---------------- QUIZ LOGIC ----------------
const quiz = [

{cat:"Data Interpretation", q:"A company’s quarterly sales (in lakh ₹) are Q1–25, Q2–35, Q3–30, Q4–40. What is the average sales per quarter?", opts:["30","32.5","33","35"], ans:"32.5", marks:1, time:"3 min"},
{cat:"Data Interpretation", q:"A bar chart shows production (tons): 2018–200, 2019–250, 2020–300, 2021–350. Find % increase from 2018 to 2021.", opts:["50%","60%","70%","75%"], ans:"75%", marks:1, time:"3 min"},
{cat:"Data Table", q:"A table shows students in 3 classes: A–40, B–35, C–25. If 60% of total are boys, how many girls?", opts:["40","45","50","55"], ans:"40", marks:1, time:"3 min"},
{cat:"Pie Chart", q:"A pie chart shows expenditure: Rent = 20%, Food = 30%, Travel = 25%, Others = 25%. If total = ₹40,000, what is spent on Travel?", opts:["9,000","10,000","12,000","14,000"], ans:"10,000", marks:1, time:"3 min"},
{cat:"Bar Graph", q:"A company’s profit (₹ lakh): 2019–20, 2020–25, 2021–30, 2022–45. Average profit = ?", opts:["25","30","32.5","35"], ans:"30", marks:1, time:"3 min"},
{cat:"Line Graph", q:"A line graph shows temperature (°C): Mon – 20, Tue – 24, Wed – 22, Thu – 26, Fri – 25. What is the median temperature?", opts:["22","23","24","25"], ans:"24", marks:1, time:"3 min"},
{cat:"Venn Diagram", q:"In a survey of 100 people: 60 like Tea, 40 like Coffee, 20 both. How many like only Tea?", opts:["30","40","50","60"], ans:"40", marks:1, time:"3 min"},
{cat:"Venn Diagram", q:"Out of 200 students, 120 play Cricket, 80 play Football, 40 both. How many play neither?", opts:["20","40","60","80"], ans:"40", marks:1, time:"3 min"},
{cat:"Data Sufficiency", q:"Find x.\n(1) x + y = 12.\n(2) y = 5.\nChoose:", opts:["1 only","2 only","Both","None"], ans:"Both", marks:1, time:"3 min"},
{cat:"Data Sufficiency", q:"Find the area of rectangle.\n(1) Perimeter = 40 m.\n(2) Length = 12 m.", opts:["1 only","2 only","Both","None"], ans:"Both", marks:1, time:"3 min"},
{cat:"Data Analysis", q:"A student scored 60, 70, 80, 90 in four tests. If each test equal weight, what is mean score?", opts:["70","75","80","85"], ans:"75", marks:1, time:"3 min"},
{cat:"Data Interpretation", q:"A firm’s revenue (₹ cr): Q1–120, Q2–150, Q3–180, Q4–210. % growth from Q2→Q4?", opts:["20%","30%","40%","50%"], ans:"40%", marks:1, time:"3 min"},
{cat:"Data Interpretation", q:"A company’s export-import ratio is 5:4. If exports = ₹200 cr, imports = ?", opts:["120","150","160","180"], ans:"160", marks:1, time:"3 min"},
{cat:"Tabular Data", q:"Department A = 40 men, 20 women; Department B = 30 men, 30 women. % of women overall?", opts:["40%","45%","50%","55%"], ans:"45%", marks:1, time:"3 min"},
{cat:"Pie Chart", q:"Distribution of budget: Education = 25%, Health = 20%, Defence = 30%, Other = 25%. If total = ₹100 cr, find Health + Other.", opts:["40 cr","45 cr","50 cr","55 cr"], ans:"45 cr", marks:1, time:"3 min"},
{cat:"Venn Diagram", q:"Of 100 students, 70 like Math, 50 like Science, 30 like both. Find number liking only Science.", opts:["10","20","30","40"], ans:"20", marks:1, time:"3 min"},
{cat:"Statistics", q:"The mean of numbers 5, 7, 9, x is 8. Find x.", opts:["9","10","11","12"], ans:"11", marks:1, time:"3 min"},
{cat:"Statistics", q:"For 10 values, Σx = 200, Σx² = 4300. Find variance.", opts:["10","20","30","40"], ans:"30", marks:1, time:"3 min"},
{cat:"Probability", q:"A die rolled once. Probability of getting even number?", opts:["1/2","1/3","2/3","5/6"], ans:"1/2", marks:1, time:"3 min"},
{cat:"Probability", q:"Two coins tossed. Probability of at least one Head?", opts:["1/4","1/2","3/4","1"], ans:"3/4", marks:1, time:"3 min"},
{cat:"Binary Logic", q:"If A=1, B=0, compute A XOR (A AND B).", opts:["0","1","Undefined","None"], ans:"1", marks:1, time:"3 min"},
{cat:"Syllogism", q:"Statements: All A are B; Some B are C. Conclusions: I) Some C are A. II) Some B are A.", opts:["Only I","Only II","Both","None"], ans:"Only II", marks:1, time:"3 min"},
{cat:"Clock", q:"Angle between hands at 4:40?", opts:["80°","90°","100°","120°"], ans:"100°", marks:1, time:"3 min"},
{cat:"Calendar", q:"If 1 Jan 2025 is Wednesday, what day is 1 Mar 2025?", opts:["Saturday","Sunday","Monday","Tuesday"], ans:"Saturday", marks:1, time:"3 min"},
{cat:"Assumption", q:"Statement: Government plans to increase tax on luxury cars.\nAssumption:", opts:["Luxury car buyers can afford it","People will stop buying","No impact on revenue","Policy is popular"], ans:"Luxury car buyers can afford it", marks:1, time:"3 min"},
{cat:"Blood Relation", q:"Pointing to a boy, Rita said: He is my father’s only son’s son. How is Rita related?", opts:["Mother","Sister","Grandmother","Aunt"], ans:"Grandmother", marks:1, time:"3 min"},
{cat:"Family Tree", q:"A is B’s father, B is C’s mother, D is C’s father. How is A related to D?", opts:["Father","Father-in-law","Brother","Uncle"], ans:"Father-in-law", marks:1, time:"3 min"},
{cat:"Logical Puzzle", q:"Five people A–E stand in a row. A is not next to B; C between D and E. Who can be at left end?", opts:["A","B","C","D"], ans:"A", marks:1, time:"3 min"},
{cat:"Puzzle", q:"Six boxes A–F stacked vertically. A above C, C below E, F not at top. Which could be topmost?", opts:["E","B","D","F"], ans:"E", marks:1, time:"3 min"},
{cat:"Data Arrangement", q:"Five friends P–T are seated around a circle. P is left of Q; R opposite S. Who is right of P?", opts:["Q","R","S","T"], ans:"Q", marks:1, time:"3 min"},
{cat:"Data Arrangement", q:"Six students A–F ranked 1–6. B after A, C before A, D after E but before B. Who is last?", opts:["C","D","E","F"], ans:"F", marks:1, time:"3 min"},
{cat:"Coding–Decoding", q:"If FLOWER = 60, what is TREE = ?", opts:["48","52","56","60"], ans:"52", marks:1, time:"3 min"},
{cat:"Coding–Decoding", q:"In a code, each letter replaced by next 3rd letter. Code for ‘TRAIN’?", opts:["WUDLQ","WUDJO","UTDJO","WUFMQ"], ans:"WUDLQ", marks:1, time:"3 min"},
{cat:"Logic Puzzle", q:"If 3 cats kill 3 mice in 3 min, how many cats needed for 100 mice in 100 min?", opts:["3","9","27","100"], ans:"3", marks:1, time:"3 min"},
{cat:"Binary Logic", q:"Evaluate: NOT(1 AND 0) OR (1 AND 1).", opts:["0","1","Undefined","2"], ans:"1", marks:1, time:"3 min"},
{cat:"Syllogism", q:"All dogs are cats. No cat is rat. Conclusions: I) No dog is rat. II) All cats are dogs.", opts:["Only I","Only II","Both","None"], ans:"Only I", marks:1, time:"3 min"},
{cat:"Clock", q:"At what time between 5 and 6 will hands be 180° apart?", opts:["5:15","5:24","5:30","5:36"], ans:"5:24", marks:1, time:"3 min"},
{cat:"Calendar", q:"If today is Friday, what day will be after 60 days?", opts:["Monday","Tuesday","Wednesday","Thursday"], ans:"Tuesday", marks:1, time:"3 min"},
{cat:"Logical Deduction", q:"All rectangles are parallelograms; some parallelograms are rhombi. Which is true?", opts:["All rhombi are rectangles","Some rectangles are rhombi","No rhombus is rectangle","None"], ans:"Some rectangles are rhombi", marks:1, time:"3 min"},
{cat:"Assumption", q:"Statement: ‘Students should read more non-fiction.’ Assumption:", opts:["Non-fiction improves knowledge","Students hate fiction","Fiction is bad","All students same"], ans:"Non-fiction improves knowledge", marks:1, time:"3 min"},
{cat:"Data Sufficiency", q:"Find x.\n(1) x²=16.\n(2) x>0.", opts:["1 only","2 only","Both","None"], ans:"Both", marks:1, time:"3 min"},
{cat:"Probability", q:"Deck of cards: find probability of drawing red card.", opts:["1/2","1/3","1/4","2/3"], ans:"1/2", marks:1, time:"3 min"},
{cat:"Statistics", q:"Mode of {2, 3, 3, 4, 5, 5, 5, 6} is ?", opts:["3","4","5","6"], ans:"5", marks:1, time:"3 min"},
{cat:"Data Interpretation", q:"A bar graph shows sales: 2019–40, 2020–60, 2021–80, 2022–100. Find % increase from 2019 to 2022.", opts:["100%","120%","150%","200%"], ans:"150%", marks:1, time:"3 min"},
{cat:"Venn Diagram", q:"In a group of 150 people, 100 know English, 80 know Hindi, 50 know both. How many know only English?", opts:["30","40","50","60"], ans:"50", marks:1, time:"3 min"},
{cat:"Data Table", q:"Department scores: A–80, B–70, C–90. Find average score.", opts:["75","80","85","90"], ans:"80", marks:1, time:"3 min"},
{cat:"Logical Puzzle", q:"Four friends P, Q, R, S play chess in pairs. P never with S, Q always with R. Which pair plays together?", opts:["P–Q","Q–R","R–S","P–R"], ans:"Q–R", marks:1, time:"3 min"},
{cat:"Data Interpretation", q:"A factory produces bikes in ratio 2:3:5 over 3 years. If total production = 1,000, find production in 2nd year.", opts:["300","350","400","500"], ans:"300", marks:1, time:"3 min"},
{cat:"Data Interpretation", q:"The population of a city increases by 10% annually. If current population is 1,00,000, what will be the population after 2 years?", opts:["1,10,000","1,20,000","1,21,000","1,25,000"], ans:"1,21,000", marks:1, time:"3 min"},
{cat:"Probability", q:"A box contains 3 red, 4 blue, and 5 green balls. One ball is drawn at random. What is the probability that it is not green?", opts:["1/3","2/3","3/5","4/5"], ans:"2/3", marks:1, time:"3 min"}

];

// STATE
let currentIndex = 0;
let responses = new Array(quiz.length).fill(null);
let studentName = "";
let timerSec = 30*60;
let timerInterval = null;
let examStarted = false;

const startCard=document.getElementById('startCard'),
      quizCard=document.getElementById('quizCard'),
      resultCard=document.getElementById('resultCard'),
      qHeading=document.getElementById('qHeading'),
      qCategory=document.getElementById('qCategory'),
      qbox=document.getElementById('qbox'),
      navNumbers=document.getElementById('navNumbers'),
      timerTop=document.getElementById('timerTop'),
      timerMain=document.getElementById('timer');

function escapeHtml(str){return String(str||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))}

function buildNav(){
  navNumbers.innerHTML='';
  quiz.forEach((_,i)=>{
    const btn=document.createElement('button');
    btn.type = "button"; // ✅ prevents form submission
    btn.textContent = i + 1;
    btn.dataset.idx = i;
    btn.onclick = () => {
      saveCurrent();
      currentIndex = i;
      renderQuestion();
    };
    navNumbers.appendChild(btn);
  });
}


function renderQuestion(){
  const item=quiz[currentIndex];
  qHeading.textContent=`Question ${currentIndex+1}`;
  qCategory.textContent=item.cat;
  let html=`<div class="qtext">${item.q}</div>`;
  item.opts.forEach((opt,i)=>{
    const checked=(responses[currentIndex]===opt)?'checked':'';
    html+=`<label class="opt"><input type="radio" name="opt" value="${escapeHtml(opt)}" ${checked}/> ${String.fromCharCode(65+i)}. ${opt}</label>`;
  });
  qbox.innerHTML=html;
  Array.from(navNumbers.children).forEach((b,idx)=>b.classList.toggle('current',idx===currentIndex));
}

function saveCurrent(){
  const sel=qbox.querySelector('input[name="opt"]:checked');
  if(sel) responses[currentIndex]=sel.value;
}

function formatTime(s){const m=Math.floor(s/60),sec=s%60;return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;}

function startExam(){
  const nameInput=document.getElementById('studentName').value.trim();
  if(!nameInput){alert('Enter your name');return;}
  studentName=nameInput;
  openFullscreen();
  startCore();
}
function startDemo(){
  studentName=document.getElementById('studentName').value.trim()||'Demo Student';
  startCore(true);
}
function startCore(demo=false){
  examStarted=true;
  startCard.style.display='none'; quizCard.style.display='block';
  timerMain.style.display=demo?'none':'block'; buildNav(); renderQuestion();
  timerInterval=setInterval(()=>{
    timerSec--; timerTop.textContent=formatTime(timerSec); timerMain.textContent=formatTime(timerSec);
    if(timerSec<=0){clearInterval(timerInterval); alert('Time up'); finishExam();}
  },1000);
}
function openFullscreen(){const el=document.documentElement; if(el.requestFullscreen) el.requestFullscreen();}
function closeFullscreen(){if(document.exitFullscreen) document.exitFullscreen();}
document.addEventListener('visibilitychange',()=>{if(examStarted&&document.hidden){alert('Tab switched. Auto-submit.');finishExam();}});
document.addEventListener('fullscreenchange',()=>{if(examStarted&&!document.fullscreenElement){alert('Exited fullscreen. Auto-submit.');finishExam();}});

document.getElementById('startBtn').addEventListener('click',e=>{e.preventDefault();startExam();});
document.getElementById('demoBtn').addEventListener('click',e=>{e.preventDefault();startDemo();});
document.getElementById('prevBtn').addEventListener('click',()=>{saveCurrent();if(currentIndex>0)currentIndex--;renderQuestion();});
document.getElementById('nextBtn').addEventListener('click',()=>{saveCurrent();if(currentIndex<quiz.length-1)currentIndex++;renderQuestion();});
document.getElementById('submitBtn').addEventListener('click',()=>{if(confirm('Submit exam?'))finishExam();});

function finishExam(){
  if(!examStarted) return;
  examStarted=false; clearInterval(timerInterval); saveCurrent();
  let score=0,max=0; const details=[];
  quiz.forEach((it,i)=>{max+=it.marks;const got=(responses[i]===it.ans)?it.marks:0;score+=got;
    details.push({q:it.q,given:responses[i]||'(no answer)',correct:it.ans,marks:got});
  });
  quizCard.style.display='none'; resultCard.style.display='block';
  document.getElementById('resultSummary').innerHTML=`<p><strong>Name:</strong> ${escapeHtml(studentName)}<br><strong>Score:</strong> ${score}/${max}</p>`;
  const d=document.getElementById('detailSummary'); d.innerHTML='';
  details.forEach((r,i)=>{const el=document.createElement('div'); el.innerHTML=`<strong>Q${i+1}:</strong> ${r.q}<br>Your: ${r.given} | Correct: ${r.correct}`; d.appendChild(el);});

  // --- send result to Google Script ---
  fetch("https://script.google.com/macros/s/AKfycbym7870t9FYTGPZqgXjxzS2WdL4ye4uqfudkpfVQHAAJUUKn6DPt6RQRCIvlyHfJmSk/exec", {
    method: "POST",
    body: new URLSearchParams({
      name: studentName,
      score: score,
      total: max,
      answers: JSON.stringify(details)
    })
  })
  .then(()=>console.log("Result sent"))
  .catch(err=>console.error("Error sending result:",err));

  try{closeFullscreen();}catch(e){}
}
</script>
</body>
</html>
