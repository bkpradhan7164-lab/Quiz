<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RRB Section Control — Full-Length Test (50 Qs)</title>
<style>
  :root{--brand:#2563eb;--danger:#b91c1c;--muted:#6b7280}
  body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial; background:#f8fafc; margin:0}
  .wrap{max-width:1100px;margin:18px auto;padding:18px}
  .card{background:#fff;border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{font-size:20px;margin:0}
  #timer{font-weight:700;color:var(--danger);font-size:16px}
  .intro ul{margin-top:6px}
  input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #e5e7eb}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
  button{background:var(--brand);color:#fff;padding:9px 12px;border-radius:8px;border:none;cursor:pointer}
  button.secondary{background:#64748b}
  .qbox{margin-top:14px}
  .qtext{font-weight:600;margin-bottom:10px}
  .opts{display:block;margin-bottom:6px}
  label.opt{display:block;padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px;cursor:pointer;background:#fff}
  label.opt input{margin-right:8px}
  .nav-numbers{display:flex;flex-wrap:wrap;gap:6px;padding:10px 0}
  .nav-numbers button{width:40px;height:36px;border-radius:6px;padding:0}
  .nav-numbers button.current{background:#60a5fa}
  .result{margin-top:12px}
  .summary{margin-top:12px;max-height:320px;overflow:auto;padding:8px;border-radius:8px;border:1px solid #e6e6e6}
  .footer{margin-top:14px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<form id="quizForm">
<div class="wrap">
  <!-- START CARD -->
  <div class="card" id="startCard">
    <header>
      <div>
        <h1>RRB Section Control — Full-Length Test 3</h1>
        <div style="color:var(--muted);margin-top:6px">60 Questions | Time: 35 minutes | Each question = 1 mark</div>
      </div>
      <div style="text-align:right">
        <div id="timer" style="display:none">35:00</div>
        <div style="font-size:12px;color:var(--muted)">Time Remaining</div>
      </div>
    </header>

    <div class="intro" style="margin-top:14px">
      <p><strong>Instructions:</strong></p>
      <ul>
        <li>Enter your name and press <strong>Start Exam</strong>. The exam will go full-screen and the 35-minute timer will begin.</li>
        <li>Do not exit full-screen or switch tabs — doing so will auto-submit your exam.</li>
        <li>You may navigate using the numbered buttons, and submit when done. The timer will auto-submit when time ends.</li>
      </ul>

      <p><label>Student name (required)</label>
      <input type="text" id="studentName" placeholder="Enter your full name" /></p>

      <div class="controls">
        <button id="startBtn">Start Exam</button>
        <button class="secondary" id="demoBtn">Demo (No Fullscreen)</button>
      </div>
    </div>
  </div>

  <!-- QUIZ CARD -->
  <div class="card" id="quizCard" style="display:none;margin-top:14px">
    <header style="align-items:flex-start">
      <div>
        <h2 id="qHeading">Question 1</h2>
        <div style="color:var(--muted)" id="qCategory"></div>
      </div>
      <div style="text-align:right">
        <div id="timerTop" style="font-weight:700;color:var(--danger);font-size:18px">35:00</div>
        <div style="font-size:12px;color:var(--muted)">Time Remaining</div>
      </div>
    </header>

    <div class="qbox" id="qbox"></div>
    <div class="nav-numbers" id="navNumbers"></div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div>
        <button id="prevBtn" class="secondary" type="button">◀ Prev</button>
        <button id="nextBtn" type="button">Next ▶</button>
      </div>
      <div>
        <button id="submitBtn" style="background:#16a34a" type="button">Submit Exam</button>
      </div>
    </div>

    <div class="footer">You must remain in full-screen mode. Switching tabs or exiting full-screen will auto-submit.</div>
  </div>

  <!-- RESULT CARD -->
  <div class="card" id="resultCard" style="display:none;margin-top:14px">
    <h2>Exam Submitted</h2>
    <div id="resultSummary" class="result"></div>
    <div class="summary" id="detailSummary"></div>
  </div>
</div>
</form>

<script>
// ---------------- QUIZ LOGIC ----------------
const quiz = [
  {cat:"Logical Reasoning", q:"In a family of 6, there are 2 married couples. How many generations minimum?", opts:["1","2","3","4"], ans:"2", marks:1},
  {cat:"Number Pattern", q:"If 2 = 6, 3 = 12, 4 = 20, then 5 = ?", opts:["25","30","35","40"], ans:"30", marks:1},
  {cat:"Coding-Decoding", q:"If TODAY = 120 and TOMORROW = 180, find relation pattern likely based on letters.", opts:["Product","Sum","Code-weight","Pattern not clear"], ans:"Pattern not clear", marks:1},
  {cat:"Classification", q:"Choose the odd one out.", opts:["Circle","Square","Triangle","Oval"], ans:"Triangle", marks:1},
  {cat:"Coding-Decoding", q:"If 'AB' = 12, 'BCD' = 24, find 'CDE' = ?", opts:["30","36","42","48"], ans:"36", marks:1},
  {cat:"Analytical Reasoning", q:"In a certain language, 'Sun rises' = 56, 'Moon shines' = 72, then 'Star glows' = ?", opts:["60","64","68","70"], ans:"64", marks:1},
  {cat:"Number Series", q:"Find the missing term: 11, 13, 17, 19, 23, ?", opts:["25","27","29","31"], ans:"29", marks:1},
  {cat:"Letter Series", q:"What will come next in the pattern: AA, BB, DD, GG, ?", opts:["JJ","KK","LL","NN"], ans:"KK", marks:1},
  {cat:"Alphabet Code", q:"If A=1, B=2, ..., Z=26, what is the sum of letters in 'LOGIC'?", opts:["52","56","58","60"], ans:"52", marks:1},
  {cat:"Clocks", q:"Find the angle between clock hands at 2:20.", opts:["40°","50°","60°","70°"], ans:"50°", marks:1},
  {cat:"Calendar", q:"If 1 Jan 2025 is Wednesday, what day is 1 Mar 2025?", opts:["Saturday","Sunday","Monday","Tuesday"], ans:"Saturday", marks:1},
  {cat:"Alphabetical Order", q:"Arrange alphabetically: 1. CHRONIC 2. CHROME 3. CHRONICLE 4. CHRYSALIS", opts:["2-1-3-4","1-2-3-4","2-3-1-4","4-2-1-3"], ans:"2-1-3-4", marks:1},
  {cat:"Analogy", q:"Battery : Energy :: Engine : ?", opts:["Power","Oil","Motion","Sound"], ans:"Motion", marks:1},
  {cat:"Coding-Decoding", q:"If FLOWER = 60, what is TREE = ?", opts:["48","52","56","60"], ans:"52", marks:1},
  {cat:"Logical Puzzle", q:"Five people—A, B, C, D, E—stand in a row. A is not next to B; C is between D and E. Which of the following can be at the left end?", opts:["A","B","C","D"], ans:"A", marks:1},
  {cat:"Algebra", q:"If x + 1/x = 3, find x² + 1/x².", opts:["5","7","8","9"], ans:"7", marks:1},
  {cat:"Arithmetic Progression", q:"If 5th term is 18 and 12th term is 46, find the common difference.", opts:["3","4","5","6"], ans:"4", marks:1},
  {cat:"Time, Speed & Distance", q:"A train passes a 200m platform in 25 sec and a man standing beside the track in 15 sec. Find its length.", opts:["150 m","180 m","200 m","250 m"], ans:"150 m", marks:1},
  {cat:"Probability", q:"Two dice are rolled. What is the probability of getting a sum divisible by 3?", opts:["1/3","5/12","1/2","7/18"], ans:"1/3", marks:1},
  {cat:"Data Interpretation", q:"If a pie chart shows Expenditure: Rent 25%, Food 30%, Travel 15%, Others 30%, and total Rs. 60,000, find expenditure on Others.", opts:["15000","18000","20000","24000"], ans:"18000", marks:1},
  {cat:"Permutation & Combination", q:"How many 5-digit numbers can be formed using digits 1–7 if repetition is not allowed?", opts:["2520","3600","5040","7200"], ans:"2520", marks:1},
  {cat:"Mensuration", q:"Find the volume of a sphere of radius 7 cm. (Use π = 22/7)", opts:["1400 cm³","1436 cm³","1500 cm³","1540 cm³"], ans:"1436 cm³", marks:1},
  {cat:"LCM & HCF", q:"If the product of two numbers is 1800 and their HCF is 30, find their LCM.", opts:["60","90","120","150"], ans:"60", marks:1},
  {cat:"Compound Interest", q:"Rs. 12,000 amounts to Rs. 13,272 in 1 year when compounded quarterly. Find the rate of interest.", opts:["9%","10%","12%","15%"], ans:"10%", marks:1},
  {cat:"Ratio & Proportion", q:"If A:B = 2:3 and B:C = 4:5, find A:C.", opts:["8:15","4:5","2:3","6:10"], ans:"8:15", marks:1},
  {cat:"Work & Time", q:"A, B, and C can do a job in 12, 15, and 20 days respectively. Working together, how long will they take?", opts:["4 days","5 days","6 days","7 days"], ans:"5 days", marks:1},
  {cat:"Logarithm", q:"If log₂(3x - 1) = 3, find x.", opts:["3","4","5","9"], ans:"3", marks:1},
  {cat:"Trigonometry", q:"If sinθ = 3/5, find cosθ.", opts:["4/5","3/4","2/5","5/3"], ans:"4/5", marks:1},
  {cat:"Statistics", q:"The mean of 10 observations is 12. If one observation 18 is replaced by 30, find new mean.", opts:["13","14","15","16"], ans:"13", marks:1},
  {cat:"Geometry", q:"The diagonals of a rhombus are 24 cm and 10 cm. Find its area.", opts:["100 cm²","110 cm²","120 cm²","130 cm²"], ans:"120 cm²", marks:1},
  {cat:"Percentage", q:"In an exam, 40% failed in Maths and 30% failed in English; 10% failed both. What percent passed both?", opts:["30%","40%","50%","60%"], ans:"40%", marks:1},
  {cat:"Linear Equation", q:"Solve: 2x - 3y = 7 and x + 4y = 5. Find x.", opts:["1","2","3","4"], ans:"2", marks:1},
  {cat:"Venn Diagram", q:"In a group of 100 students, 70 play Cricket, 50 play Football, 20 both. How many play neither?", opts:["0","10","20","30"], ans:"0", marks:1},
  {cat:"Binary Logic", q:"If A = 1, B = 0, compute A XOR (A AND B).", opts:["0","1","Undefined","None"], ans:"1", marks:1},
  {cat:"Data Sufficiency", q:"Q: What is x? (1) x² = 25 (2) x is positive.", opts:["1 alone","2 alone","Both needed","None"], ans:"Both needed", marks:1},
  {cat:"Number Series", q:"5, 10, 20, 40, ?, 160", opts:["60","80","100","120"], ans:"80", marks:1},
  {cat:"Analogy", q:"Oxygen : Air :: Carbon : ?", opts:["Fuel","Diamond","Coal","Atom"], ans:"Coal", marks:1},
  {cat:"Syllogism", q:"Statements: All A are B; Some B are C. Conclusions: (I) Some C are A. (II) Some B are A.", opts:["Only I","Only II","Both","None"], ans:"Only II", marks:1},
  {cat:"Clock", q:"Find the angle between hands at 4:40.", opts:["80°","90°","100°","120°"], ans:"100°", marks:1},
  {cat:"Coding-Decoding", q:"In a code, each letter is replaced by the 3rd next letter. What is the code for 'TRAIN'?", opts:["WUDLQ","WUDJO","UTDJO","WUFMQ"], ans:"WUDLQ", marks:1},
  {cat:"Ranking", q:"In a line of 60 students, A is 20th from left and B is 15th from right. How many between them if they interchange places?", opts:["25","24","23","21"], ans:"23", marks:1},
  {cat:"Puzzle", q:"Six boxes are stacked vertically labeled A–F. If A is above C, C is below E, and F is not at top, which could be the topmost box?", opts:["E","B","D","F"], ans:"E", marks:1},
  {cat:"Blood Relation", q:"Pointing to a photograph, Raj said: “He is my father’s son’s son.” How is Raj related?", opts:["Father","Brother","Grandfather","Uncle"], ans:"Grandfather", marks:1},
  {cat:"Clock", q:"At what time between 5 and 6 will the hands be 180° apart?", opts:["5:15","5:24","5:30","5:36"], ans:"5:24", marks:1},
  {cat:"Number Series", q:"2, 3, 5, 8, 12, 17, ?", opts:["23","24","25","26"], ans:"23", marks:1},
  {cat:"Logical Puzzle", q:"If 3 cats kill 3 mice in 3 minutes, how many cats needed to kill 100 mice in 100 minutes?", opts:["3","9","27","100"], ans:"3", marks:1},
  {cat:"Analogy", q:"Flower : Petal :: Book : ?", opts:["Leaf","Page","Paper","Word"], ans:"Page", marks:1},
  {cat:"Direction Sense", q:"A person walks 3 km North, 4 km East, 5 km South. How far and in what direction from starting point?", opts:["2 km West","2 km East","6 km East","4 km East"], ans:"2 km East", marks:1},
  {cat:"Mensuration", q:"If side of cube increases by 50%, its volume increases by:", opts:["125%","150%","237.5%","300%"], ans:"237.5%", marks:1},
  {cat:"Arrangement", q:"Arrange logically: 1. Seed 2. Fruit 3. Tree 4. Flower", opts:["1-3-4-2","1-4-3-2","1-2-3-4","1-3-2-4"], ans:"1-3-4-2", marks:1},
  {cat:"Probability", q:"A bag has 6 red, 5 blue, 4 green balls. One picked at random. Probability of not being red?", opts:["1/2","9/15","3/5","2/5"], ans:"3/5", marks:1},
  {cat:"Logic", q:"If all squares are rectangles, and some rectangles are circles, which is true?", opts:["All circles are squares","Some squares may be circles","No circle is square","None"], ans:"Some squares may be circles", marks:1},
  {cat:"Binary Logic", q:"Evaluate: NOT(1 AND 0) OR (1 AND 1).", opts:["0","1","Undefined","2"], ans:"1", marks:1},
  {cat:"Family Relation", q:"Pointing to a lady, a man said, “Her husband’s brother is my father.” How is the lady related to the man?", opts:["Mother","Aunt","Sister-in-law","Cousin"], ans:"Mother", marks:1},
  {cat:"Analogy", q:"Water : Thirst :: Food : ?", opts:["Hunger","Energy","Sleep","Drink"], ans:"Hunger", marks:1},
  {cat:"Pattern", q:"Fill in the blank: A1, B2, C4, D8, E16, ?", opts:["F24","F32","F64","F48"], ans:"F32", marks:1},
  {cat:"Number Series", q:"Find the next term: 1, 4, 9, 16, 25, ?", opts:["30","35","36","49"], ans:"36", marks:1},
  {cat:"Work & Time", q:"A can complete work in 9 days; B alone takes 18 days. If A works 3 days and B completes rest, total time = ?", opts:["9 days","10 days","11 days","12 days"], ans:"11 days", marks:1},
  {cat:"Critical Reasoning", q:"“All students who study regularly pass exams. Ramesh did not pass.” Which inference is valid?", opts:["Ramesh studied regularly","Ramesh did not study regularly","All others failed","None"], ans:"Ramesh did not study regularly", marks:1},
  {cat:"Puzzle", q:"If 1 → 5, 2 → 25, 3 → 125, then 4 → ?", opts:["256","512","625","725"], ans:"625", marks:1}
];

// STATE
let currentIndex = 0;
let responses = new Array(quiz.length).fill(null);
let studentName = "";
let timerSec = 35*60;
let timerInterval = null;
let examStarted = false;

const startCard=document.getElementById('startCard'),
      quizCard=document.getElementById('quizCard'),
      resultCard=document.getElementById('resultCard'),
      qHeading=document.getElementById('qHeading'),
      qCategory=document.getElementById('qCategory'),
      qbox=document.getElementById('qbox'),
      navNumbers=document.getElementById('navNumbers'),
      timerTop=document.getElementById('timerTop'),
      timerMain=document.getElementById('timer');

function escapeHtml(str){return String(str||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))}

function buildNav(){
  navNumbers.innerHTML='';
  quiz.forEach((_,i)=>{
    const btn=document.createElement('button');
    btn.type = "button"; // ✅ prevents form submission
    btn.textContent = i + 1;
    btn.dataset.idx = i;
    btn.onclick = () => {
      saveCurrent();
      currentIndex = i;
      renderQuestion();
    };
    navNumbers.appendChild(btn);
  });
}


function renderQuestion(){
  const item=quiz[currentIndex];
  qHeading.textContent=`Question ${currentIndex+1}`;
  qCategory.textContent=item.cat;
  let html=`<div class="qtext">${item.q}</div>`;
  item.opts.forEach((opt,i)=>{
    const checked=(responses[currentIndex]===opt)?'checked':'';
    html+=`<label class="opt"><input type="radio" name="opt" value="${escapeHtml(opt)}" ${checked}/> ${String.fromCharCode(65+i)}. ${opt}</label>`;
  });
  qbox.innerHTML=html;
  Array.from(navNumbers.children).forEach((b,idx)=>b.classList.toggle('current',idx===currentIndex));
}

function saveCurrent(){
  const sel=qbox.querySelector('input[name="opt"]:checked');
  if(sel) responses[currentIndex]=sel.value;
}

function formatTime(s){const m=Math.floor(s/60),sec=s%60;return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;}

function startExam(){
  const nameInput=document.getElementById('studentName').value.trim();
  if(!nameInput){alert('Enter your name');return;}
  studentName=nameInput;
  openFullscreen();
  startCore();
}
function startDemo(){
  studentName=document.getElementById('studentName').value.trim()||'Demo Student';
  startCore(true);
}
function startCore(demo=false){
  examStarted=true;
  startCard.style.display='none'; quizCard.style.display='block';
  timerMain.style.display=demo?'none':'block'; buildNav(); renderQuestion();
  timerInterval=setInterval(()=>{
    timerSec--; timerTop.textContent=formatTime(timerSec); timerMain.textContent=formatTime(timerSec);
    if(timerSec<=0){clearInterval(timerInterval); alert('Time up'); finishExam();}
  },1000);
}
function openFullscreen(){const el=document.documentElement; if(el.requestFullscreen) el.requestFullscreen();}
function closeFullscreen(){if(document.exitFullscreen) document.exitFullscreen();}
document.addEventListener('visibilitychange',()=>{if(examStarted&&document.hidden){alert('Tab switched. Auto-submit.');finishExam();}});
document.addEventListener('fullscreenchange',()=>{if(examStarted&&!document.fullscreenElement){alert('Exited fullscreen. Auto-submit.');finishExam();}});

document.getElementById('startBtn').addEventListener('click',e=>{e.preventDefault();startExam();});
document.getElementById('demoBtn').addEventListener('click',e=>{e.preventDefault();startDemo();});
document.getElementById('prevBtn').addEventListener('click',()=>{saveCurrent();if(currentIndex>0)currentIndex--;renderQuestion();});
document.getElementById('nextBtn').addEventListener('click',()=>{saveCurrent();if(currentIndex<quiz.length-1)currentIndex++;renderQuestion();});
document.getElementById('submitBtn').addEventListener('click',()=>{if(confirm('Submit exam?'))finishExam();});

function finishExam(){
  if(!examStarted) return;
  examStarted=false; clearInterval(timerInterval); saveCurrent();
  let score=0,max=0; const details=[];
  quiz.forEach((it,i)=>{max+=it.marks;const got=(responses[i]===it.ans)?it.marks:0;score+=got;
    details.push({q:it.q,given:responses[i]||'(no answer)',correct:it.ans,marks:got});
  });
  quizCard.style.display='none'; resultCard.style.display='block';
  document.getElementById('resultSummary').innerHTML=`<p><strong>Name:</strong> ${escapeHtml(studentName)}<br><strong>Score:</strong> ${score}/${max}</p>`;
  const d=document.getElementById('detailSummary'); d.innerHTML='';
  details.forEach((r,i)=>{const el=document.createElement('div'); el.innerHTML=`<strong>Q${i+1}:</strong> ${r.q}<br>Your: ${r.given} | Correct: ${r.correct}`; d.appendChild(el);});

  // --- send result to Google Script ---
  fetch("https://script.google.com/macros/s/AKfycbym7870t9FYTGPZqgXjxzS2WdL4ye4uqfudkpfVQHAAJUUKn6DPt6RQRCIvlyHfJmSk/exec", {
    method: "POST",
    body: new URLSearchParams({
      name: studentName,
      score: score,
      total: max,
      answers: JSON.stringify(details)
    })
  })
  .then(()=>console.log("Result sent"))
  .catch(err=>console.error("Error sending result:",err));

  try{closeFullscreen();}catch(e){}
}
</script>
</body>
</html>
